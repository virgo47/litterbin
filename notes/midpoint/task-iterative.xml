<!--
Valid from midPoint 4.4, starting point example:
https://github.com/Evolveum/midpoint/blob/74280c5f506796da81a921ffc024fe941d2e147f/model/model-intest/src/test/resources/password/task-change-jack-account-password.xml
-->

<task xmlns="http://midpoint.evolveum.com/xml/ns/public/common/common-3"
      xmlns:q="http://prism.evolveum.com/xml/ns/public/query-3"
      xmlns:s="http://midpoint.evolveum.com/xml/ns/public/model/scripting-3">

    <name>test-task</name>
    <!-- ownerRef will be added after import-->
<!--    <ownerRef oid="00000000-0000-0000-0000-000000000002" type="UserType"/>-->
    <executionState>runnable</executionState>
    <activity>
        <work>
            <iterativeScripting>
                <objects>
                    <type>UserType</type>
                    <!-- optional, now it will process all users
                    <query>
                        <q:filter>
                            <q:equal>
                                <q:path>name</q:path>
                                <q:value>jack</q:value>
                            </q:equal>
                        </q:filter>
                    </query>
                    <useRepositoryDirectly>true</useRepositoryDirectly>
                    -->
                </objects>
                <scriptExecutionRequest>
                    <s:execute>
                        <s:script>
                            <code>
                                if (basic.stringify(input.name)[-1] == '0') {
                                    throw new IllegalStateException("Fatally failing on user: " + input.name)
                                }
                            </code>
                        </s:script>
                    </s:execute>
                </scriptExecutionRequest>
            </iterativeScripting>
        </work>
    </activity>
</task>